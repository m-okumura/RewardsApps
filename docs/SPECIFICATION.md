# ポイ活アプリ システム仕様書

## 1. 概要

### 1.1 プロジェクト概要

日常生活のついでにポイントを貯め、お金やギフトに交換できる「ポイ活（ポイント活動）」アプリケーションのシステム仕様書である。本アプリは、レシート買取・移動/歩数計測・アンケート回答・オンラインショッピングなど、複数のポイ活機能を統合し、ユーザーが簡単にポイントを貯められることを目指す。

### 1.2 参考アプリケーション

| アプリ名 | 主な機能 | 特徴 |
|---------|---------|------|
| **CODE（コード）** | レシート・移動・バーコード | 700万DL突破。1pt=1円、30サービス以上に交換可能。家計簿・クエスト・抽選機能 |
| **ポイ活アンケート マクロミル** | アンケート回答 | 国内最大級アンケートサイト。1pt=1円。友達紹介でポイント獲得 |
| **ONE（ワン）** | レシート買取・オンラインショッピング | 600万DL。レシート買取でキャッシュバック。ONEモールで通販キャッシュバック |
| **ダイエットBOX** | 歩数計測 | ヘルスケア連携で歩数→ポイント→商品交換。北海道食材など |
| **Pint（ピント）** | 歩数・時間・買い物 | いつもの暮らしでポイントが貯まる |

---

## 2. システム構成

### 2.1 アーキテクチャ概要

```
┌─────────────────────┐
│   モバイルアプリ     │
│   (Flutter / Dart)   │
│   iOS / Android     │
└──────────┬──────────┘
           │ REST API
           ▼
┌─────────────────────┐
│   フロントエンド     │
│ (Next.js/TypeScript) │
│  管理画面・Web       │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│     バックエンド     │
│  (FastAPI / Python)  │
└──────────┬──────────┘
           │
           ├──────────────┐
           ▼              ▼
┌─────────────────┐ ┌─────────────────┐
│   データベース   │ │ データダッシュボード │
│   (PostgreSQL)  │ │ QuickSight/Looker │
└─────────────────┘ └─────────────────┘
```

### 2.2 技術スタック

| レイヤー | フレームワーク | 言語 | 備考 |
|---------|---------------|------|------|
| **モバイルアプリ** | Flutter | Dart | iOS / Android 対応 |
| **フロントエンド** | Next.js | TypeScript | 管理画面・Web版 |
| **バックエンド** | FastAPI | Python | REST API |
| **データダッシュボード** | QuickSight または Looker | - | 分析・可視化 |

---

## 3. モバイルアプリ仕様（Flutter）

### 3.1 対応プラットフォーム

- **iOS**: 14.0 以降
- **Android**: API 21 以降

### 3.2 主要機能一覧

#### 3.2.1 ユーザー管理

| 機能 | 説明 | 備考 |
|-----|------|------|
| 会員登録 | メールアドレス/SNS認証 | メール認証必須 |
| ログイン | メール/パスワード、SNS連携 | Apple Sign-In、Google Sign-In 対応 |
| プロフィール | ニックネーム、アイコン、通知設定 | - |
| 本人確認 | 出金時のKYC | 運転免許証/マイナンバーカード |

#### 3.2.2 レシート機能

| 機能 | 説明 | 参考 |
|-----|------|------|
| レシート撮影 | カメラでレシートを撮影しOCRで読み取り | ONE, CODE |
| レシート登録 | 購入商品・金額・店舗などを登録 | 1日上限枚数は検討 |
| レシート買取 | 指定商品購入でキャッシュバック | 1円〜数千円 |
| 日替わりレシート | 毎日更新される買取対象商品 | ONE |
| 家計簿連携 | レシートを家計簿として自動記録 | CODE |

#### 3.2.3 移動・歩数機能

| 機能 | 説明 | 参考 |
|-----|------|------|
| 歩数計測 | ヘルスケア/Google Fit 連携で自動計測 | ダイエットBOX, CODE |
| 移動距離 | GPS/移動距離に応じてポイント付与 | CODE |
| ボトル消費 | 溜まったボトルを消費してポイント獲得 | CODE |

#### 3.2.4 アンケート機能

| 機能 | 説明 | 参考 |
|-----|------|------|
| アンケート一覧 | 回答可能なアンケートの表示 | マクロミル |
| アンケート回答 | 回答完了でポイント付与 | スキマ時間対応 |
| アンケート通知 | 新着アンケートのプッシュ通知 | - |

#### 3.2.5 ショッピング機能

| 機能 | 説明 | 参考 |
|-----|------|------|
| モール/EC連携 | 提携ECから購入でキャッシュバック | ONEモール |
| バーコードくじ | バーコードスキャンで抽選 | CODE |
| クエスト | 特定商品購入で高額ポイント | CODE |

#### 3.2.6 ポイント・交換機能

| 機能 | 説明 | 備考 |
|-----|------|------|
| ポイント残高 | 現在のポイント残高表示 | 1pt=1円 |
| 交換先 | PayPay、楽天、Amazonギフト、現金 etc. | 30サービス以上を目標 |
| 最低交換額 | 300pt以上で交換可能 | 参考アプリ準拠 |
| 交換履歴 | 過去の交換履歴の確認 | - |

#### 3.2.7 その他機能

| 機能 | 説明 | 参考 |
|-----|------|------|
| 友達紹介 | 紹介でポイント獲得 | マクロミル |
| 抽選・キャンペーン | 高額ポイント・景品の抽選 | CODE, ONE |
| スクラッチ | スクラッチで特典獲得 | ONE |
| お知らせ | アプリ内通知・お知らせ | - |
| ヘルプ・お問い合わせ | FAQ、お問い合わせフォーム | - |

### 3.3 モバイルアプリ 画面構成

```
Main
├── ホーム（ダッシュボード）
├── レシート
│   ├── 撮影・登録
│   ├── 買取対象一覧
│   └── 登録履歴
├── 移動・歩数
│   ├── 今日の歩数
│   ├── ボトル状況
│   └── 履歴
├── アンケート
│   ├── 一覧
│   └── 回答
├── ショッピング
│   ├── モール
│   └── クエスト
├── ポイント
│   ├── 残高
│   ├── 交換
│   └── 履歴
├── マイページ
│   ├── プロフィール
│   ├── 設定
│   ├── 友達紹介
│   └── ヘルプ
└── 通知
```

### 3.4 権限・連携

| 項目 | 用途 |
|-----|------|
| カメラ | レシート撮影 |
| 位置情報 | 移動距離計測（オプション） |
| ヘルスケア連携 | 歩数データ取得（iOS） |
| フォトライブラリ | レシート画像選択 |
| プッシュ通知 | アンケート・キャンペーン通知 |

---

## 4. フロントエンド仕様（Next.js）

### 4.1 構成

- **管理画面**: 運営者向けダッシュボード
- **Web版**: モバイルアプリと同等機能をWebで提供（オプション）

### 4.2 管理画面機能

| 機能 | 説明 |
|-----|------|
| ユーザー管理 | ユーザー一覧・検索・停止 |
| レシート審査 | 不正レシートの審査・却下 |
| ポイント管理 | 手動付与・調整・履歴 |
| キャンペーン管理 | 抽選・クエスト・買取商品の設定 |
| アンケート管理 | アンケート作成・公開・集計 |
| お知らせ管理 | プッシュ通知・お知らせの配信 |
| 分析 | ユーザー数・ポイント付与・交換率 等 |

### 4.3 技術要件

- Next.js 14+ (App Router)
- TypeScript
- 認証: NextAuth.js または同等
- UI: shadcn/ui, Tailwind CSS 等

---

## 5. バックエンド仕様（FastAPI）

### 5.1 API設計方針

- RESTful API
- JWT による認証
- OpenAPI (Swagger) ドキュメント自動生成
- バージョニング: `/api/v1/`

### 5.2 主要APIエンドポイント

#### 認証

| メソッド | エンドポイント | 説明 |
|---------|---------------|------|
| POST | `/api/v1/auth/register` | 会員登録 |
| POST | `/api/v1/auth/login` | ログイン |
| POST | `/api/v1/auth/refresh` | トークン更新 |
| POST | `/api/v1/auth/sns/*` | SNS連携ログイン |

#### ユーザー

| メソッド | エンドポイント | 説明 |
|---------|---------------|------|
| GET | `/api/v1/users/me` | 自分のプロフィール |
| PATCH | `/api/v1/users/me` | プロフィール更新 |

#### レシート

| メソッド | エンドポイント | 説明 |
|---------|---------------|------|
| POST | `/api/v1/receipts` | レシート登録（画像アップロード） |
| GET | `/api/v1/receipts` | レシート一覧 |
| GET | `/api/v1/receipts/buy-back-targets` | 買取対象商品一覧 |
| GET | `/api/v1/receipts/{id}` | レシート詳細 |

#### 歩数・移動

| メソッド | エンドポイント | 説明 |
|---------|---------------|------|
| POST | `/api/v1/fitness/steps` | 歩数データ連携 |
| GET | `/api/v1/fitness/points` | ボトル・ポイント状況 |
| POST | `/api/v1/fitness/consume` | ボトル消費 |

#### アンケート

| メソッド | エンドポイント | 説明 |
|---------|---------------|------|
| GET | `/api/v1/surveys` | アンケート一覧 |
| GET | `/api/v1/surveys/{id}` | アンケート詳細 |
| POST | `/api/v1/surveys/{id}/answers` | 回答送信 |

#### ポイント

| メソッド | エンドポイント | 説明 |
|---------|---------------|------|
| GET | `/api/v1/points/balance` | ポイント残高 |
| GET | `/api/v1/points/history` | ポイント履歴 |
| POST | `/api/v1/points/exchange` | ポイント交換申請 |
| GET | `/api/v1/points/exchange-options` | 交換先一覧 |

#### その他

| メソッド | エンドポイント | 説明 |
|---------|---------------|------|
| POST | `/api/v1/referrals` | 友達紹介 |
| GET | `/api/v1/campaigns` | キャンペーン一覧 |
| POST | `/api/v1/shopping/track` | EC購入トラッキング |

### 5.3 データベース設計（主要テーブル）

| テーブル | 主なカラム |
|---------|------------|
| users | id, email, password_hash, name, created_at |
| receipts | id, user_id, image_url, store, amount, items, status |
| fitness_logs | id, user_id, steps, distance, date |
| surveys | id, title, points, expires_at |
| survey_answers | id, survey_id, user_id, answers |
| point_transactions | id, user_id, amount, type, description |
| exchanges | id, user_id, amount, destination, status |

### 5.4 技術要件

- FastAPI
- SQLAlchemy (ORM)
- PostgreSQL
- Redis (キャッシュ・セッション)
- Celery (非同期タスク: OCR, メール送信 等)
- AWS S3 (画像ストレージ)

---

## 6. データダッシュボード仕様

### 6.1 ツール候補

- **Amazon QuickSight**: AWS連携が容易、コスト効率
- **Looker (Looker Studio)**: 高度な分析、BigQuery連携

### 6.2 想定KPI・指標

| カテゴリ | 指標例 |
|---------|--------|
| ユーザー | DAU/MAU、新規登録数、リテンション |
| ポイント | 付与総数、交換総数、平均残高 |
| レシート | 登録枚数、買取率、不正率 |
| アンケート | 回答数、完了率 |
| 決済 | 交換手数料、提携先別交換数 |

---

## 7. 非機能要件

### 7.1 セキュリティ

- 通信: HTTPS必須
- パスワード: bcrypt/Argon2 によるハッシュ
- 個人情報: 暗号化保存、アクセスログ
- 不正対策: レシート重複チェック、異常検知

### 7.2 パフォーマンス

- API応答: 200ms以内（目標）
- 画像アップロード: 5MB以内、圧縮後に保存

### 7.3 可用性

- 目標稼働率: 99.9%
- バックアップ: 日次

### 7.4 法規制・コンプライアンス

- プライバシーポリシー
- 利用規約
- 個人情報保護法対応
- アプリストア審査ガイドライン準拠

---

## 8. マイルストーン（例）

| フェーズ | 内容 | 期間目安 |
|---------|------|---------|
| Phase 1 | 認証・ユーザー管理・レシート基本機能 | 2-3ヶ月 |
| Phase 2 | 歩数連携・アンケート・ポイント交換 | 2-3ヶ月 |
| Phase 3 | ショッピング連携・友達紹介・キャンペーン | 2ヶ月 |
| Phase 4 | 管理画面・ダッシュボード・改善 | 継続 |

---

## 9. 参考リンク

- [CODE - ポイ活アプリ](https://apps.apple.com/jp/app/移動とレシートがお金にかわるポイ活アプリcode-コード/id879385562)
- [ポイ活アンケート マクロミル](https://apps.apple.com/jp/app/ポイ活アンケート-マクロミル-ポイント貯まる副業-節約アプリ/id533065594)
- [ONE(ワン) - レシート買取&お買い物アプリ](https://apps.apple.com/jp/app/one-ワン-お金がもらえるレシート買取-お買い物アプリ/id1373644984)
- [ダイエットBOX](https://apps.apple.com/jp/app/ダイエットbox/id1517758575)

---

## 変更履歴

| 日付 | 版 | 変更内容 |
|------|-----|---------|
| 2025-02-12 | 1.0 | 初版作成 |
